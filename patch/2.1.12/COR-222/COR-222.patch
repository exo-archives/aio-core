Index: component/document/pom.xml
===================================================================
--- component/document/pom.xml	(revision 65455)
+++ component/document/pom.xml	(working copy)
@@ -1,130 +1,124 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<!--
-
-    Copyright (C) 2003-2010 eXo Platform SAS.
-
-    This program is free software; you can redistribute it and/or
-    modify it under the terms of the GNU Affero General Public License
-    as published by the Free Software Foundation; either version 3
-    of the License, or (at your option) any later version.
-
-    This program is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-    GNU General Public License for more details.
-
-    You should have received a copy of the GNU General Public License
-    along with this program; if not, see <http://www.gnu.org/licenses />.
-
--->
-<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
-  <modelVersion>4.0.0</modelVersion>
-  <parent>
-    <groupId>org.exoplatform.core</groupId>
-    <artifactId>core-component</artifactId>
-    <version>2.1.12-SNAPSHOT</version>
-  </parent>
-  <artifactId>exo.core.component.document</artifactId>
-  <packaging>jar</packaging>
-  <name>eXo Core demo service Impl</name>
-  <description>eXo demo service Impl</description>
-  <dependencies>
-    <dependency>
-      <groupId>org.exoplatform.kernel</groupId>
-      <artifactId>exo.kernel.component.common</artifactId>
-      <version>${org.exoplatform.kernel.version}</version>
-    </dependency>
-    <dependency>
-      <groupId>org.exoplatform.kernel</groupId>
-      <artifactId>exo.kernel.container</artifactId>
-      <version>${org.exoplatform.kernel.version}</version>
-    </dependency>
-    <dependency>
-      <groupId>org.exoplatform.kernel</groupId>
-      <artifactId>exo.kernel.commons</artifactId>
-      <version>${org.exoplatform.kernel.version}</version>
-    </dependency>
-    <dependency>
-      <groupId>junit</groupId>
-      <artifactId>junit</artifactId>
-      <version>3.8.1</version>
-    </dependency>
-    <dependency>
-      <groupId>commons-logging</groupId>
-      <artifactId>commons-logging</artifactId>
-      <version>1.0.4</version>
-    </dependency>
-    <dependency>
-      <groupId>org.exoplatform.tool</groupId>
-      <artifactId>exo.tool.framework.junit</artifactId>
-      <version>1.0.0</version>
-    </dependency>
-    <dependency>
-      <groupId>pdfbox</groupId>
-      <artifactId>pdfbox</artifactId>
-      <version>0.7.2</version>
-      <scope>compile</scope>
-    </dependency>
-    <dependency>
-      <groupId>com.lowagie</groupId>
-      <artifactId>itext</artifactId>
-      <version>2.1.0</version>
-      <scope>compile</scope>
-    </dependency>
-    <dependency>
-      <groupId>html-parser</groupId>
-      <artifactId>html-parser</artifactId>
-      <version>1.6</version>
-      <scope>compile</scope>
-    </dependency>
-    <dependency>
-      <groupId>org.apache.poi</groupId>
-      <artifactId>poi</artifactId>
-      <!--version>3.0-FINAL</version-->
-      <version>3.0.2-FINAL</version>
-      <scope>compile</scope>
-    </dependency>
-    <dependency>
-      <groupId>org.apache.poi</groupId>
-      <artifactId>poi-scratchpad</artifactId>
-      <version>3.0.2-FINAL</version>
-      <scope>compile</scope>
-    </dependency>
-  </dependencies>
-  <build>
-    <plugins>
-      <plugin>
-        <groupId>org.apache.maven.plugins</groupId>
-        <artifactId>maven-surefire-plugin</artifactId>
-        <configuration>
-         <excludes>
-           <!-- JCR-1398 Big XLS document hangs document reader -->
-           <exclude>**/TestBigXLSDocumentReader.java</exclude>
-         </excludes>
-        </configuration>
-      </plugin>
-    </plugins>
-    <testResources>
-      <testResource>
-        <directory>src/test/resources</directory>
-        <includes>
-          <include>**/*.properties</include>
-          <include>**/*.xml</include>
-          <include>**/*.drl</include>
-          <include>**/*.vm</include>
-          <include>**/*.doc</include>
-          <include>**/*.dot</include>
-          <include>**/*.xls</include>
-          <include>**/*.ppt</include>
-          <include>**/*.txt</include>
-          <include>**/*.tiff</include>
-          <include>**/*.pdf</include>
-          <include>**/*.odt</include>
-          <include>**/*.html</include>
-          <include>**/*.msg</include>
-          <include>**/*.pst</include>
-        </includes>
-      </testResource>
-    </testResources>
-  </build>
-</project>
+<?xml version="1.0" encoding="UTF-8"?>
+<!--
+
+    Copyright (C) 2003-2010 eXo Platform SAS.
+
+    This program is free software; you can redistribute it and/or
+    modify it under the terms of the GNU Affero General Public License
+    as published by the Free Software Foundation; either version 3
+    of the License, or (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, see <http://www.gnu.org/licenses />.
+
+-->
+<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
+  <modelVersion>4.0.0</modelVersion>
+  <parent>
+    <groupId>org.exoplatform.core</groupId>
+    <artifactId>core-component</artifactId>
+    <version>2.1.12-SNAPSHOT</version>
+  </parent>
+  <artifactId>exo.core.component.document</artifactId>
+  <packaging>jar</packaging>
+  <name>eXo Core demo service Impl</name>
+  <description>eXo demo service Impl</description>
+  <dependencies>
+    <dependency>
+      <groupId>org.exoplatform.kernel</groupId>
+      <artifactId>exo.kernel.component.common</artifactId>
+      <version>${org.exoplatform.kernel.version}</version>
+    </dependency>
+    <dependency>
+      <groupId>org.exoplatform.kernel</groupId>
+      <artifactId>exo.kernel.container</artifactId>
+      <version>${org.exoplatform.kernel.version}</version>
+    </dependency>
+    <dependency>
+      <groupId>org.exoplatform.kernel</groupId>
+      <artifactId>exo.kernel.commons</artifactId>
+      <version>${org.exoplatform.kernel.version}</version>
+    </dependency>
+    <dependency>
+      <groupId>junit</groupId>
+      <artifactId>junit</artifactId>
+      <version>3.8.1</version>
+    </dependency>
+    <dependency>
+      <groupId>commons-logging</groupId>
+      <artifactId>commons-logging</artifactId>
+      <version>1.0.4</version>
+    </dependency>
+    <dependency>
+      <groupId>org.exoplatform.tool</groupId>
+      <artifactId>exo.tool.framework.junit</artifactId>
+      <version>1.0.0</version>
+    </dependency>
+    <dependency>
+      <groupId>org.apache.pdfbox</groupId>
+      <artifactId>pdfbox</artifactId>
+      <version>1.1.0</version>
+      <scope>compile</scope>
+    </dependency>
+    <dependency>
+      <groupId>html-parser</groupId>
+      <artifactId>html-parser</artifactId>
+      <version>1.6</version>
+      <scope>compile</scope>
+    </dependency>
+    <dependency>
+      <groupId>org.apache.poi</groupId>
+      <artifactId>poi</artifactId>
+      <!--version>3.0-FINAL</version-->
+      <version>3.0.2-FINAL</version>
+      <scope>compile</scope>
+    </dependency>
+    <dependency>
+      <groupId>org.apache.poi</groupId>
+      <artifactId>poi-scratchpad</artifactId>
+      <version>3.0.2-FINAL</version>
+      <scope>compile</scope>
+    </dependency>
+  </dependencies>
+  <build>
+    <plugins>
+      <plugin>
+        <groupId>org.apache.maven.plugins</groupId>
+        <artifactId>maven-surefire-plugin</artifactId>
+        <configuration>
+         <excludes>
+           <!-- JCR-1398 Big XLS document hangs document reader -->
+           <exclude>**/TestBigXLSDocumentReader.java</exclude>
+         </excludes>
+        </configuration>
+      </plugin>
+    </plugins>
+    <testResources>
+      <testResource>
+        <directory>src/test/resources</directory>
+        <includes>
+          <include>**/*.properties</include>
+          <include>**/*.xml</include>
+          <include>**/*.drl</include>
+          <include>**/*.vm</include>
+          <include>**/*.doc</include>
+          <include>**/*.dot</include>
+          <include>**/*.xls</include>
+          <include>**/*.ppt</include>
+          <include>**/*.txt</include>
+          <include>**/*.tiff</include>
+          <include>**/*.pdf</include>
+          <include>**/*.odt</include>
+          <include>**/*.html</include>
+          <include>**/*.msg</include>
+          <include>**/*.pst</include>
+        </includes>
+      </testResource>
+    </testResources>
+  </build>
+</project>
Index: component/document/src/main/java/org/exoplatform/services/document/impl/PDFDocumentReader.java
===================================================================
--- component/document/src/main/java/org/exoplatform/services/document/impl/PDFDocumentReader.java	(revision 65455)
+++ component/document/src/main/java/org/exoplatform/services/document/impl/PDFDocumentReader.java	(working copy)
@@ -16,31 +16,25 @@
  */
 package org.exoplatform.services.document.impl;
 
-import java.io.ByteArrayInputStream;
+import org.apache.commons.logging.Log;
+import org.apache.jempbox.xmp.XMPMetadata;
+import org.apache.jempbox.xmp.XMPSchemaBasic;
+import org.apache.jempbox.xmp.XMPSchemaDublinCore;
+import org.apache.jempbox.xmp.XMPSchemaPDF;
+import org.apache.pdfbox.exceptions.InvalidPasswordException;
+import org.apache.pdfbox.pdmodel.PDDocument;
+import org.apache.pdfbox.pdmodel.PDDocumentCatalog;
+import org.apache.pdfbox.pdmodel.PDDocumentInformation;
+import org.apache.pdfbox.pdmodel.common.PDMetadata;
+import org.apache.pdfbox.util.PDFTextStripper;
+import org.exoplatform.services.document.DCMetaData;
+import org.exoplatform.services.log.ExoLogger;
+
 import java.io.InputStream;
 import java.io.StringWriter;
 import java.util.Calendar;
-import java.util.HashMap;
 import java.util.Properties;
 
-import javax.xml.parsers.DocumentBuilder;
-import javax.xml.parsers.DocumentBuilderFactory;
-
-import org.pdfbox.pdmodel.PDDocument;
-import org.pdfbox.util.PDFTextStripper;
-import org.w3c.dom.Document;
-import org.w3c.dom.Node;
-import org.w3c.dom.NodeList;
-
-import org.apache.commons.logging.Log;
-
-import org.exoplatform.commons.utils.ISO8601;
-import org.exoplatform.services.document.DCMetaData;
-import org.exoplatform.services.log.ExoLogger;
-
-import com.lowagie.text.pdf.PdfDate;
-import com.lowagie.text.pdf.PdfReader;
-
 /**
  * Created by The eXo Platform SAS A parser of Adobe PDF files.
  * 
@@ -96,158 +90,167 @@
    */
   public Properties getProperties(InputStream is) throws Exception {
 
-    Properties props = null;
-
-    PdfReader reader = new PdfReader(is, "".getBytes());
-
-    // Read the file metadata
-    byte[] metadata = reader.getMetadata();
-
-    if (metadata != null) {
-      // there is XMP metadata try exctract it
-      props = getPropertiesFromMetadata(metadata);
-    }
-
-    if (props == null) {
-      // it's old pdf document version
-      props = getPropertiesFromInfo(reader.getInfo());
-    }
-    reader.close();
-    return props;
-  }
-
-  /**
-   * Extract properties from XMP xml.
-   * 
-   * @param metadata XML as byte array
-   * @return extracted properties
-   * @throws Exception if extracting fails
-   */
-  protected Properties getPropertiesFromMetadata(byte[] metadata) throws Exception {
-
-    Properties props = null;
-
-    // parse xml
-    DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
-    DocumentBuilder docBuilder = dbf.newDocumentBuilder();
-    Document doc = docBuilder.parse(new ByteArrayInputStream(metadata));
-
-    // Check is there PDF/A-1 XMP
-    String version = "";
-    NodeList list = doc.getElementsByTagName("pdfaid:conformance");
-    if (list != null && list.item(0) != null) {
-      version += list.item(0).getTextContent() + "-";
-    }
-
-    list = doc.getElementsByTagName("pdfaid:part");
-    if (list != null && list.item(0) != null) {
-      version += list.item(0).getTextContent();
-    }
-
-    // PDF/A-1a or PDF/A-1b
-    if (version.equalsIgnoreCase("A-1")) {
-      props = getPropsFromPDFAMetadata(doc);
-    }
-
-    return props;
-  }
-
-  /**
-   * Extracts properties from PDF Info hash set.
-   * 
-   * @param Pdf Info hash set
-   * @return Extracted properties
-   * @throws Exception if extracting fails
-   */
-  protected Properties getPropertiesFromInfo(HashMap info) throws Exception {
+    PDDocument pdDocument = PDDocument.load(is);
     Properties props = new Properties();
+    try {
+      if (pdDocument.isEncrypted()) {
+        try {
+          pdDocument.decrypt("");
+        } catch (InvalidPasswordException e) {
+          throw new Exception("The pdf document is encrypted.");
+        } catch (org.apache.pdfbox.exceptions.CryptographyException e) {
+          throw e;
+        }
+      }
 
-    String title = (String) info.get("Title");
-    if (title != null) {
-      props.put(DCMetaData.TITLE, title);
-    }
+      PDDocumentCatalog catalog = pdDocument.getDocumentCatalog();
+      PDMetadata meta = catalog.getMetadata();
+      if (meta != null) {
+        XMPMetadata metadata = meta.exportXMPMetadata();
 
-    String author = (String) info.get("Author");
-    if (author != null) {
-      props.put(DCMetaData.CREATOR, author);
-    }
+        XMPSchemaDublinCore dc = metadata.getDublinCoreSchema();
+        if (dc != null) {
+          try {
+            if (dc.getTitle() != null)
+              props.put(DCMetaData.TITLE, dc.getTitle());
+          } catch (Exception e) {
+            log.warn("getTitle failed: " + e);
+          }
+          try {
+            if (dc.getDescription() != null)
+              props.put(DCMetaData.DESCRIPTION, dc.getDescription());
+          } catch (Exception e) {
+            log.warn("getSubject failed: " + e);
+          }
 
-    String subject = (String) info.get("Subject");
-    if (subject != null) {
-      props.put(DCMetaData.SUBJECT, subject);
-    }
+          try {
+            if (dc.getCreators() != null) {
+              for (String creator : dc.getCreators()) {
+                props.put(DCMetaData.CREATOR, creator);
+              }
+            }
+          } catch (Exception e) {
+            log.warn("getCreator failed: " + e);
+          }
 
-    /*
-     * String publisher = (String) info.get("Producer"); if (publisher != null)
-     * { props.put(DCMetaData.PUBLISHER, publisher); } String description =
-     * (String) info.get("Desc"); if (description != null) {
-     * props.put(DCMetaData.DESCRIPTION, description); }
-     */
+          try {
+            if (dc.getDates() != null) {
+              for (Calendar date : dc.getDates()) {
+                props.put(DCMetaData.DATE, date);
+              }
+            }
+          } catch (Exception e) {
+            log.warn("getDate failed: " + e);
+          }
+        }
 
-    String creationDate = (String) info.get("CreationDate");
-    if (creationDate != null) {
-      props.put(DCMetaData.DATE, PdfDate.decode(creationDate));
-    }
+        XMPSchemaPDF pdf = metadata.getPDFSchema();
+        if (pdf != null) {
+          try {
+            if (pdf.getKeywords() != null)
+              props.put(DCMetaData.SUBJECT, pdf.getKeywords());
+          } catch (Exception e) {
+            log.warn("getKeywords failed: " + e);
+          }
 
-    String modDate = (String) info.get("ModDate");
-    if (modDate != null) {
-      props.put(DCMetaData.DATE, PdfDate.decode(modDate));
-    }
+          try {
+            if (pdf.getProducer() != null)
+              props.put(DCMetaData.PUBLISHER, pdf.getProducer());
+          } catch (Exception e) {
+            log.warn("getProducer failed: " + e);
+          }
+        }
 
-    return props;
-  }
+        XMPSchemaBasic basic = metadata.getBasicSchema();
+        if (basic != null) {
+          try {
+            if (basic.getCreateDate() != null)
+              props.put(DCMetaData.DATE, basic.getCreateDate());
+          } catch (Exception e) {
+            log.warn("getCreationDate failed: " + e);
+          }
+          try {
+            if (basic.getModifyDate() != null)
+              props.put(DCMetaData.DATE, basic.getModifyDate());
+          } catch (Exception e) {
+            log.warn("getModificationDate failed: " + e);
+          }
+          // try
+          // {
+          // if (basic.getCreatorTool() != null)
+          // props.put(DCMetaData.PUBLISHER, basic.getCreatorTool());
+          // }
+          // catch (Exception e)
+          // {
+          // log.warn("getCreatorTool failed: " + e);
+          // }
+        }
+      } else {
+        // The pdf doesn't contain any metadata, try to use the document
+        // information instead
+        PDDocumentInformation docInfo = pdDocument.getDocumentInformation();
 
-  private Properties getPropsFromPDFAMetadata(Document doc) throws Exception {
-    Properties props = new Properties();
-    // get properties
-    NodeList list = doc.getElementsByTagName("rdf:li");
-    if (list != null && list.getLength() > 0) {
-      for (int i = 0; i < list.getLength(); i++) {
+        if (docInfo != null) {
+          try {
+            if (docInfo.getAuthor() != null)
+              props.put(DCMetaData.CONTRIBUTOR, docInfo.getAuthor());
+          } catch (Exception e) {
+            log.warn("getAuthor failed: " + e);
+          }
+          try {
+            if (docInfo.getCreationDate() != null)
+              props.put(DCMetaData.DATE, docInfo.getCreationDate());
+          } catch (Exception e) {
+            log.warn("getCreationDate failed: " + e);
+          }
+          try {
+            if (docInfo.getCreator() != null)
+              props.put(DCMetaData.CREATOR, docInfo.getCreator());
+          } catch (Exception e) {
+            log.warn("getCreator failed: " + e);
+          }
+          try {
 
-        Node n = list.item(i);
-        // dc:title - TITLE
-        if (n.getParentNode().getParentNode().getNodeName().equals("dc:title")) {
-          String title = n.getLastChild().getTextContent();
-          props.put(DCMetaData.TITLE, title);
-        }
+            if (docInfo.getKeywords() != null)
+              props.put(DCMetaData.SUBJECT, docInfo.getKeywords());
+          } catch (Exception e) {
+            log.warn("getKeywords failed: " + e);
+          }
+          try {
+            if (docInfo.getModificationDate() != null)
+              props.put(DCMetaData.DATE, docInfo.getModificationDate());
+          } catch (Exception e) {
+            log.warn("getModificationDate failed: " + e);
+          }
+          try {
+            if (docInfo.getProducer() != null)
+              props.put(DCMetaData.PUBLISHER, docInfo.getProducer());
+          } catch (Exception e) {
+            log.warn("getProducer failed: " + e);
+          }
+          try {
+            if (docInfo.getSubject() != null)
+              props.put(DCMetaData.DESCRIPTION, docInfo.getSubject());
+          } catch (Exception e) {
+            log.warn("getSubject failed: " + e);
+          }
+          try {
+            if (docInfo.getTitle() != null)
+              props.put(DCMetaData.TITLE, docInfo.getTitle());
+          } catch (Exception e) {
+            log.warn("getTitle failed: " + e);
+          }
 
-        // dc:creator - CREATOR
-        if (n.getParentNode().getParentNode().getNodeName().equals("dc:creator")) {
-          String author = n.getLastChild().getTextContent();
-          props.put(DCMetaData.CREATOR, author);
+          // docInfo.getTrapped();
         }
-
-        // DC:description - SUBJECT
-        if (n.getParentNode().getParentNode().getNodeName().equals("dc:description")) {
-          String description = n.getLastChild().getTextContent();
-          props.put(DCMetaData.SUBJECT, description);
-          // props.put(DCMetaData.DESCRIPTION, description);
-        }
       }
-    }
 
-    // xmp:CreateDate - DATE
-    list = doc.getElementsByTagName("xmp:CreateDate");
-    if (list != null && list.item(0) != null) {
-      Node creationDateNode = list.item(0).getLastChild();
-      if (creationDateNode != null) {
-        String creationDate = creationDateNode.getTextContent();
-        Calendar c = ISO8601.parseEx(creationDate);
-        props.put(DCMetaData.DATE, c);
+    } finally {
+      if (pdDocument != null) {
+        pdDocument.close();
       }
     }
 
-    // xmp:ModifyDate - DATE
-    list = doc.getElementsByTagName("xmp:ModifyDate");
-    if (list != null && list.item(0) != null) {
-      Node modifyDateNode = list.item(0).getLastChild();
-      if (modifyDateNode != null) {
-        String modifyDate = modifyDateNode.getTextContent();
-        Calendar c = ISO8601.parseEx(modifyDate);
-        props.put(DCMetaData.DATE, c);
-      }
-    }
     return props;
   }
-
 }
Index: component/document/src/test/java/org/exoplatform/services/document/test/TestPropertiesExtracting.java
===================================================================
--- component/document/src/test/java/org/exoplatform/services/document/test/TestPropertiesExtracting.java	(revision 65455)
+++ component/document/src/test/java/org/exoplatform/services/document/test/TestPropertiesExtracting.java	(working copy)
@@ -16,20 +16,18 @@
  */
 package org.exoplatform.services.document.test;
 
-import java.io.InputStream;
-import java.util.Calendar;
-import java.util.Iterator;
-import java.util.Map;
-import java.util.Properties;
-
 import junit.framework.TestCase;
 
-import org.exoplatform.commons.utils.ISO8601;
 import org.exoplatform.container.PortalContainer;
 import org.exoplatform.services.document.DCMetaData;
 import org.exoplatform.services.document.DocumentReader;
 import org.exoplatform.services.document.DocumentReaderService;
 
+import java.io.InputStream;
+import java.util.Iterator;
+import java.util.Map;
+import java.util.Properties;
+
 public class TestPropertiesExtracting extends TestCase {
 
   DocumentReaderService service_;
@@ -60,14 +58,29 @@
     Properties etalon = new Properties();
     etalon.put(DCMetaData.TITLE, "Test de convertion de fichier tif");
     etalon.put(DCMetaData.CREATOR, "Christian Klaus");
-    etalon.put(DCMetaData.SUBJECT, "20080901 TEST Christian Etat OK");
-    Calendar c = ISO8601.parseEx("2008-09-01T08:01:10+00:00");
-    ;
-    etalon.put(DCMetaData.DATE, c);
+    etalon.put(DCMetaData.DESCRIPTION, "20080901 TEST Christian Etat OK");
+    // Calendar c = ISO8601.parseEx("2008-09-01T08:01:10+00:00");
+    // etalon.put(DCMetaData.DATE, c);
 
-    evalProps(etalon, testprops);
+    evalProps(etalon, testprops, false);
   }
 
+  public void testPDFDocumentReaderServiceBrokenFile() throws Exception {
+    InputStream is = TestPropertiesExtracting.class.getResourceAsStream("/pfs_accapp.pdf");
+    try {
+
+      DocumentReader rdr = service_.getDocumentReader("application/pdf");
+      Properties testprops = rdr.getProperties(is);
+      Properties etalon = new Properties();
+      etalon.put(DCMetaData.TITLE, "Personal Account Opening Form VN");
+      etalon.put(DCMetaData.CREATOR, "mr");
+      etalon.put(DCMetaData.PUBLISHER, "Adobe LiveCycle Designer ES 8.2");
+      evalProps(etalon, testprops, false);
+    } finally {
+      is.close();
+    }
+  }
+
   public void testWordDocumentReaderService() throws Exception {
     InputStream is = TestPropertiesExtracting.class.getResourceAsStream("/test.doc");
     Properties props = service_.getDocumentReader("application/msword").getProperties(is);
@@ -102,7 +115,7 @@
     }
   }
 
-  private void evalProps(Properties etalon, Properties testedProps) {
+  private void evalProps(Properties etalon, Properties testedProps, boolean testSize) {
     Iterator it = etalon.entrySet().iterator();
     while (it.hasNext()) {
       Map.Entry prop = (Map.Entry) it.next();
@@ -110,7 +123,9 @@
       assertNotNull(prop.getKey() + " property not founded. ", tval);
       assertEquals(prop.getKey() + " property value is incorrect", prop.getValue(), tval);
     }
-    assertEquals("size is incorrect", etalon.size(), testedProps.size());
+    if (testSize) {
+      assertEquals("size is incorrect", etalon.size(), testedProps.size());
+    }
   }
 
 }
Index: component/document/src/test/resources/pfs_accapp.pdf
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/octet-stream

Property changes on: component\document\src\test\resources\pfs_accapp.pdf
___________________________________________________________________
Added: svn:mime-type
   + application/octet-stream

